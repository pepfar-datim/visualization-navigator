{"ast":null,"code":"import { FetchError } from '../../engine';\nexport const parseContentType = contentType => contentType ? contentType.split(';')[0].trim().toLowerCase() : '';\nexport const parseStatus = async response => {\n  const accessError = response.status === 401 || response.status === 403 || response.status === 409;\n\n  if (accessError) {\n    let message;\n    let details = {};\n\n    try {\n      details = await response.json();\n      message = details.message;\n    } catch (e) {// Do nothing\n    } // Set a message in case of invalid json, or json without 'message' property\n\n\n    if (!message) {\n      message = response.status === 401 ? 'Unauthorized' : 'Forbidden';\n    }\n\n    throw new FetchError({\n      type: 'access',\n      message,\n      details\n    });\n  }\n\n  if (response.status < 200 || response.status >= 400) {\n    const message = \"An unknown error occurred - \".concat(response.statusText, \" (\").concat(response.status, \")\");\n    let details = {};\n\n    try {\n      details = await response.json();\n    } catch (e) {// We can leave details as is if parsing fails\n    }\n\n    throw new FetchError({\n      type: 'unknown',\n      message,\n      details\n    });\n  }\n\n  return response;\n};\nexport function fetchData(url) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return fetch(url, { ...options,\n    credentials: 'include',\n    headers: {\n      'X-Requested-With': 'XMLHttpRequest',\n      Accept: 'application/json',\n      ...options.headers\n    }\n  }).catch(err => {\n    throw new FetchError({\n      type: 'network',\n      message: 'An unknown network error occurred',\n      details: err\n    });\n  }).then(parseStatus).then(async response => {\n    const contentType = parseContentType(response.headers.get('Content-Type')); // 'application/json'\n\n    if (contentType === 'application/json') {\n      return await response.json(); // Will throw if invalid JSON!\n    } // 'text/*'\n\n\n    if (/^text\\/[a-z0-9.-]+$/.test(contentType)) {\n      return await response.text();\n    }\n\n    return await response.blob();\n  });\n}","map":{"version":3,"names":["FetchError","parseContentType","contentType","split","trim","toLowerCase","parseStatus","response","accessError","status","message","details","json","e","type","concat","statusText","fetchData","url","options","fetch","credentials","headers","Accept","catch","err","then","get","test","text","blob"],"sources":["/home/jake/SRC/visualization-navigator-ts/node_modules/@dhis2/app-runtime/node_modules/@dhis2/app-service-data/build/es/links/RestAPILink/fetchData.js"],"sourcesContent":["import { FetchError } from '../../engine';\nexport const parseContentType = contentType => contentType ? contentType.split(';')[0].trim().toLowerCase() : '';\nexport const parseStatus = async response => {\n  const accessError = response.status === 401 || response.status === 403 || response.status === 409;\n\n  if (accessError) {\n    let message;\n    let details = {};\n\n    try {\n      details = await response.json();\n      message = details.message;\n    } catch (e) {// Do nothing\n    } // Set a message in case of invalid json, or json without 'message' property\n\n\n    if (!message) {\n      message = response.status === 401 ? 'Unauthorized' : 'Forbidden';\n    }\n\n    throw new FetchError({\n      type: 'access',\n      message,\n      details\n    });\n  }\n\n  if (response.status < 200 || response.status >= 400) {\n    const message = \"An unknown error occurred - \".concat(response.statusText, \" (\").concat(response.status, \")\");\n    let details = {};\n\n    try {\n      details = await response.json();\n    } catch (e) {// We can leave details as is if parsing fails\n    }\n\n    throw new FetchError({\n      type: 'unknown',\n      message,\n      details\n    });\n  }\n\n  return response;\n};\nexport function fetchData(url, options = {}) {\n  return fetch(url, { ...options,\n    credentials: 'include',\n    headers: {\n      'X-Requested-With': 'XMLHttpRequest',\n      Accept: 'application/json',\n      ...options.headers\n    }\n  }).catch(err => {\n    throw new FetchError({\n      type: 'network',\n      message: 'An unknown network error occurred',\n      details: err\n    });\n  }).then(parseStatus).then(async response => {\n    const contentType = parseContentType(response.headers.get('Content-Type')); // 'application/json'\n\n    if (contentType === 'application/json') {\n      return await response.json(); // Will throw if invalid JSON!\n    } // 'text/*'\n\n\n    if (/^text\\/[a-z0-9.-]+$/.test(contentType)) {\n      return await response.text();\n    }\n\n    return await response.blob();\n  });\n}"],"mappings":"AAAA,SAASA,UAAT,QAA2B,cAA3B;AACA,OAAO,MAAMC,gBAAgB,GAAGC,WAAW,IAAIA,WAAW,GAAGA,WAAW,CAACC,KAAZ,CAAkB,GAAlB,EAAuB,CAAvB,EAA0BC,IAA1B,GAAiCC,WAAjC,EAAH,GAAoD,EAAvG;AACP,OAAO,MAAMC,WAAW,GAAG,MAAMC,QAAN,IAAkB;EAC3C,MAAMC,WAAW,GAAGD,QAAQ,CAACE,MAAT,KAAoB,GAApB,IAA2BF,QAAQ,CAACE,MAAT,KAAoB,GAA/C,IAAsDF,QAAQ,CAACE,MAAT,KAAoB,GAA9F;;EAEA,IAAID,WAAJ,EAAiB;IACf,IAAIE,OAAJ;IACA,IAAIC,OAAO,GAAG,EAAd;;IAEA,IAAI;MACFA,OAAO,GAAG,MAAMJ,QAAQ,CAACK,IAAT,EAAhB;MACAF,OAAO,GAAGC,OAAO,CAACD,OAAlB;IACD,CAHD,CAGE,OAAOG,CAAP,EAAU,CAAC;IACZ,CARc,CAQb;;;IAGF,IAAI,CAACH,OAAL,EAAc;MACZA,OAAO,GAAGH,QAAQ,CAACE,MAAT,KAAoB,GAApB,GAA0B,cAA1B,GAA2C,WAArD;IACD;;IAED,MAAM,IAAIT,UAAJ,CAAe;MACnBc,IAAI,EAAE,QADa;MAEnBJ,OAFmB;MAGnBC;IAHmB,CAAf,CAAN;EAKD;;EAED,IAAIJ,QAAQ,CAACE,MAAT,GAAkB,GAAlB,IAAyBF,QAAQ,CAACE,MAAT,IAAmB,GAAhD,EAAqD;IACnD,MAAMC,OAAO,GAAG,+BAA+BK,MAA/B,CAAsCR,QAAQ,CAACS,UAA/C,EAA2D,IAA3D,EAAiED,MAAjE,CAAwER,QAAQ,CAACE,MAAjF,EAAyF,GAAzF,CAAhB;IACA,IAAIE,OAAO,GAAG,EAAd;;IAEA,IAAI;MACFA,OAAO,GAAG,MAAMJ,QAAQ,CAACK,IAAT,EAAhB;IACD,CAFD,CAEE,OAAOC,CAAP,EAAU,CAAC;IACZ;;IAED,MAAM,IAAIb,UAAJ,CAAe;MACnBc,IAAI,EAAE,SADa;MAEnBJ,OAFmB;MAGnBC;IAHmB,CAAf,CAAN;EAKD;;EAED,OAAOJ,QAAP;AACD,CA1CM;AA2CP,OAAO,SAASU,SAAT,CAAmBC,GAAnB,EAAsC;EAAA,IAAdC,OAAc,uEAAJ,EAAI;EAC3C,OAAOC,KAAK,CAACF,GAAD,EAAM,EAAE,GAAGC,OAAL;IAChBE,WAAW,EAAE,SADG;IAEhBC,OAAO,EAAE;MACP,oBAAoB,gBADb;MAEPC,MAAM,EAAE,kBAFD;MAGP,GAAGJ,OAAO,CAACG;IAHJ;EAFO,CAAN,CAAL,CAOJE,KAPI,CAOEC,GAAG,IAAI;IACd,MAAM,IAAIzB,UAAJ,CAAe;MACnBc,IAAI,EAAE,SADa;MAEnBJ,OAAO,EAAE,mCAFU;MAGnBC,OAAO,EAAEc;IAHU,CAAf,CAAN;EAKD,CAbM,EAaJC,IAbI,CAaCpB,WAbD,EAacoB,IAbd,CAamB,MAAMnB,QAAN,IAAkB;IAC1C,MAAML,WAAW,GAAGD,gBAAgB,CAACM,QAAQ,CAACe,OAAT,CAAiBK,GAAjB,CAAqB,cAArB,CAAD,CAApC,CAD0C,CACkC;;IAE5E,IAAIzB,WAAW,KAAK,kBAApB,EAAwC;MACtC,OAAO,MAAMK,QAAQ,CAACK,IAAT,EAAb,CADsC,CACR;IAC/B,CALyC,CAKxC;;;IAGF,IAAI,sBAAsBgB,IAAtB,CAA2B1B,WAA3B,CAAJ,EAA6C;MAC3C,OAAO,MAAMK,QAAQ,CAACsB,IAAT,EAAb;IACD;;IAED,OAAO,MAAMtB,QAAQ,CAACuB,IAAT,EAAb;EACD,CA1BM,CAAP;AA2BD"},"metadata":{},"sourceType":"module"}