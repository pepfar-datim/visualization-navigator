{"ast":null,"code":"import _objectSpread from \"/home/jake/SRC/landing-page/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _slicedToArray from \"/home/jake/SRC/landing-page/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { useState, useCallback, useRef, useEffect } from 'react';\nimport { FetchError } from '../../engine';\nimport { useStaticInput } from './useStaticInput';\nexport var useQueryExecutor = function useQueryExecutor(_ref) {\n  var execute = _ref.execute,\n      initialVariables = _ref.variables,\n      singular = _ref.singular,\n      immediate = _ref.immediate,\n      onComplete = _ref.onComplete,\n      onError = _ref.onError;\n\n  var _useStaticInput = useStaticInput(execute),\n      _useStaticInput2 = _slicedToArray(_useStaticInput, 1),\n      theExecute = _useStaticInput2[0];\n\n  var _useState = useState({\n    called: !!immediate,\n    loading: !!immediate\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      state = _useState2[0],\n      setState = _useState2[1];\n\n  var variables = useRef(initialVariables);\n  var abortControllersRef = useRef([]);\n  var abort = useCallback(function () {\n    abortControllersRef.current.forEach(function (controller) {\n      return controller.abort();\n    });\n    abortControllersRef.current = [];\n  }, []);\n  var manualAbort = useCallback(function () {\n    abort();\n    setState(function (state) {\n      return {\n        called: state.called,\n        loading: false,\n        error: new FetchError({\n          type: 'aborted',\n          message: 'Aborted'\n        })\n      };\n    });\n  }, [abort]);\n  var refetch = useCallback(function () {\n    var newVariables = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    setState(function (state) {\n      return !state.called || !state.loading ? {\n        called: true,\n        loading: true\n      } : state;\n    });\n\n    if (singular) {\n      abort(); // Cleanup any in-progress fetches\n    }\n\n    var controller = new AbortController();\n    abortControllersRef.current.push(controller);\n    variables.current = _objectSpread(_objectSpread({}, variables.current), newVariables);\n    var options = {\n      variables: variables.current,\n      signal: controller.signal,\n      onComplete: onComplete,\n      onError: onError\n    };\n    return theExecute(options).then(function (data) {\n      if (!controller.signal.aborted) {\n        setState({\n          called: true,\n          loading: false,\n          data: data\n        });\n        return data;\n      }\n\n      return new Promise(function () {\n        return undefined;\n      }); // Wait forever\n    }).catch(function (error) {\n      if (!controller.signal.aborted) {\n        setState({\n          called: true,\n          loading: false,\n          error: error\n        });\n      }\n\n      return new Promise(function () {\n        return undefined;\n      }); // Don't throw errors in refetch promises, wait forever\n    });\n  }, [abort, onComplete, onError, singular, theExecute]); // Don't include immediate or refetch as deps, otherwise unintentional refetches\n  // may be triggered by changes to input, i.e. recreating the onComplete callback\n\n  useEffect(function () {\n    if (immediate) {\n      refetch();\n    }\n\n    return abort;\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return _objectSpread({\n    refetch: refetch,\n    abort: manualAbort\n  }, state);\n};","map":{"version":3,"names":["useState","useCallback","useRef","useEffect","FetchError","useStaticInput","useQueryExecutor","execute","initialVariables","variables","singular","immediate","onComplete","onError","theExecute","called","loading","state","setState","abortControllersRef","abort","current","forEach","controller","manualAbort","error","type","message","refetch","newVariables","AbortController","push","options","signal","then","data","aborted","Promise","undefined","catch"],"sources":["/home/jake/SRC/landing-page/node_modules/@dhis2/app-runtime/node_modules/@dhis2/app-service-data/build/es/react/hooks/useQueryExecutor.js"],"sourcesContent":["import { useState, useCallback, useRef, useEffect } from 'react';\nimport { FetchError } from '../../engine';\nimport { useStaticInput } from './useStaticInput';\nexport const useQueryExecutor = ({\n  execute,\n  variables: initialVariables,\n  singular,\n  immediate,\n  onComplete,\n  onError\n}) => {\n  const [theExecute] = useStaticInput(execute);\n  const [state, setState] = useState({\n    called: !!immediate,\n    loading: !!immediate\n  });\n  const variables = useRef(initialVariables);\n  const abortControllersRef = useRef([]);\n  const abort = useCallback(() => {\n    abortControllersRef.current.forEach(controller => controller.abort());\n    abortControllersRef.current = [];\n  }, []);\n  const manualAbort = useCallback(() => {\n    abort();\n    setState(state => ({\n      called: state.called,\n      loading: false,\n      error: new FetchError({\n        type: 'aborted',\n        message: 'Aborted'\n      })\n    }));\n  }, [abort]);\n  const refetch = useCallback((newVariables = {}) => {\n    setState(state => !state.called || !state.loading ? {\n      called: true,\n      loading: true\n    } : state);\n\n    if (singular) {\n      abort(); // Cleanup any in-progress fetches\n    }\n\n    const controller = new AbortController();\n    abortControllersRef.current.push(controller);\n    variables.current = { ...variables.current,\n      ...newVariables\n    };\n    const options = {\n      variables: variables.current,\n      signal: controller.signal,\n      onComplete,\n      onError\n    };\n    return theExecute(options).then(data => {\n      if (!controller.signal.aborted) {\n        setState({\n          called: true,\n          loading: false,\n          data\n        });\n        return data;\n      }\n\n      return new Promise(() => undefined); // Wait forever\n    }).catch(error => {\n      if (!controller.signal.aborted) {\n        setState({\n          called: true,\n          loading: false,\n          error\n        });\n      }\n\n      return new Promise(() => undefined); // Don't throw errors in refetch promises, wait forever\n    });\n  }, [abort, onComplete, onError, singular, theExecute]); // Don't include immediate or refetch as deps, otherwise unintentional refetches\n  // may be triggered by changes to input, i.e. recreating the onComplete callback\n\n  useEffect(() => {\n    if (immediate) {\n      refetch();\n    }\n\n    return abort;\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return {\n    refetch,\n    abort: manualAbort,\n    ...state\n  };\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}