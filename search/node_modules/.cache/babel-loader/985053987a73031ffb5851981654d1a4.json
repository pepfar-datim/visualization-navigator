{"ast":null,"code":"import { joinPath } from './path';\nimport { validateResourceQuery } from './validateQuery';\n\nvar encodeQueryParameter = function encodeQueryParameter(param) {\n  if (Array.isArray(param)) {\n    return param.map(encodeQueryParameter).join(',');\n  }\n\n  if (typeof param === 'string') {\n    return encodeURIComponent(param);\n  }\n\n  if (typeof param === 'number' || typeof param === 'boolean') {\n    return String(param);\n  }\n\n  if (typeof param === 'object') {\n    throw new Error('Object parameter mappings not yet implemented');\n  }\n\n  throw new Error('Unknown parameter type');\n};\n\nvar queryParametersMapToArray = function queryParametersMapToArray(params) {\n  return Object.keys(params).reduce(function (out, key) {\n    var value = params[key];\n\n    if (key === 'filter' && Array.isArray(value)) {\n      value.forEach(function (item) {\n        out.push({\n          key: 'filter',\n          value: item\n        });\n      });\n    } else if (params[key] !== null && params[key] !== undefined) {\n      out.push({\n        key: key,\n        value: params[key]\n      });\n    }\n\n    return out;\n  }, []);\n};\n\nvar queryParametersToQueryString = function queryParametersToQueryString(params) {\n  var expandedParams = queryParametersMapToArray(params);\n  return expandedParams.map(function (_ref) {\n    var key = _ref.key,\n        value = _ref.value;\n    return \"\".concat(encodeURIComponent(key), \"=\").concat(encodeQueryParameter(value));\n  }).join('&');\n};\n\nvar actionPrefix = 'action::';\n\nvar isAction = function isAction(resource) {\n  return resource.startsWith(actionPrefix);\n};\n\nvar makeActionPath = function makeActionPath(resource) {\n  return joinPath('dhis-web-commons', \"\".concat(resource.substr(actionPrefix.length), \".action\"));\n};\n\nvar skipApiVersion = function skipApiVersion(resource, config) {\n  if (resource === 'tracker' || resource.startsWith('tracker/')) {\n    var _config$serverVersion, _config$serverVersion2;\n\n    if (!((_config$serverVersion = config.serverVersion) !== null && _config$serverVersion !== void 0 && _config$serverVersion.minor) || ((_config$serverVersion2 = config.serverVersion) === null || _config$serverVersion2 === void 0 ? void 0 : _config$serverVersion2.minor) < 38) {\n      return true;\n    }\n  }\n\n  return false;\n};\n\nexport var queryToResourcePath = function queryToResourcePath(link, query, type) {\n  var resource = query.resource,\n      id = query.id,\n      _query$params = query.params,\n      params = _query$params === void 0 ? {} : _query$params;\n  var apiBase = skipApiVersion(resource, link.config) ? link.unversionedApiPath : link.versionedApiPath;\n  var base = isAction(resource) ? makeActionPath(resource) : joinPath(apiBase, resource, id);\n  validateResourceQuery(query, type);\n\n  if (Object.keys(params).length) {\n    return \"\".concat(base, \"?\").concat(queryParametersToQueryString(params));\n  }\n\n  return base;\n};","map":{"version":3,"names":["joinPath","validateResourceQuery","encodeQueryParameter","param","Array","isArray","map","join","encodeURIComponent","String","Error","queryParametersMapToArray","params","Object","keys","reduce","out","key","value","forEach","item","push","undefined","queryParametersToQueryString","expandedParams","concat","actionPrefix","isAction","resource","startsWith","makeActionPath","substr","length","skipApiVersion","config","_config$serverVersion","_config$serverVersion2","serverVersion","minor","queryToResourcePath","link","query","type","id","apiBase","unversionedApiPath","versionedApiPath","base"],"sources":["/home/jake/SRC/visualization-navigator-ts/node_modules/@dhis2/app-runtime/node_modules/@dhis2/app-service-data/build/es/links/RestAPILink/queryToResourcePath.js"],"sourcesContent":["import { joinPath } from './path';\nimport { validateResourceQuery } from './validateQuery';\n\nconst encodeQueryParameter = param => {\n  if (Array.isArray(param)) {\n    return param.map(encodeQueryParameter).join(',');\n  }\n\n  if (typeof param === 'string') {\n    return encodeURIComponent(param);\n  }\n\n  if (typeof param === 'number' || typeof param === 'boolean') {\n    return String(param);\n  }\n\n  if (typeof param === 'object') {\n    throw new Error('Object parameter mappings not yet implemented');\n  }\n\n  throw new Error('Unknown parameter type');\n};\n\nconst queryParametersMapToArray = params => Object.keys(params).reduce((out, key) => {\n  const value = params[key];\n\n  if (key === 'filter' && Array.isArray(value)) {\n    value.forEach(item => {\n      out.push({\n        key: 'filter',\n        value: item\n      });\n    });\n  } else if (params[key] !== null && params[key] !== undefined) {\n    out.push({\n      key,\n      value: params[key]\n    });\n  }\n\n  return out;\n}, []);\n\nconst queryParametersToQueryString = params => {\n  const expandedParams = queryParametersMapToArray(params);\n  return expandedParams.map(({\n    key,\n    value\n  }) => \"\".concat(encodeURIComponent(key), \"=\").concat(encodeQueryParameter(value))).join('&');\n};\n\nconst actionPrefix = 'action::';\n\nconst isAction = resource => resource.startsWith(actionPrefix);\n\nconst makeActionPath = resource => joinPath('dhis-web-commons', \"\".concat(resource.substr(actionPrefix.length), \".action\"));\n\nconst skipApiVersion = (resource, config) => {\n  if (resource === 'tracker' || resource.startsWith('tracker/')) {\n    var _config$serverVersion, _config$serverVersion2;\n\n    if (!((_config$serverVersion = config.serverVersion) !== null && _config$serverVersion !== void 0 && _config$serverVersion.minor) || ((_config$serverVersion2 = config.serverVersion) === null || _config$serverVersion2 === void 0 ? void 0 : _config$serverVersion2.minor) < 38) {\n      return true;\n    }\n  }\n\n  return false;\n};\n\nexport const queryToResourcePath = (link, query, type) => {\n  const {\n    resource,\n    id,\n    params = {}\n  } = query;\n  const apiBase = skipApiVersion(resource, link.config) ? link.unversionedApiPath : link.versionedApiPath;\n  const base = isAction(resource) ? makeActionPath(resource) : joinPath(apiBase, resource, id);\n  validateResourceQuery(query, type);\n\n  if (Object.keys(params).length) {\n    return \"\".concat(base, \"?\").concat(queryParametersToQueryString(params));\n  }\n\n  return base;\n};"],"mappings":"AAAA,SAASA,QAAT,QAAyB,QAAzB;AACA,SAASC,qBAAT,QAAsC,iBAAtC;;AAEA,IAAMC,oBAAoB,GAAG,SAAvBA,oBAAuB,CAAAC,KAAK,EAAI;EACpC,IAAIC,KAAK,CAACC,OAAN,CAAcF,KAAd,CAAJ,EAA0B;IACxB,OAAOA,KAAK,CAACG,GAAN,CAAUJ,oBAAV,EAAgCK,IAAhC,CAAqC,GAArC,CAAP;EACD;;EAED,IAAI,OAAOJ,KAAP,KAAiB,QAArB,EAA+B;IAC7B,OAAOK,kBAAkB,CAACL,KAAD,CAAzB;EACD;;EAED,IAAI,OAAOA,KAAP,KAAiB,QAAjB,IAA6B,OAAOA,KAAP,KAAiB,SAAlD,EAA6D;IAC3D,OAAOM,MAAM,CAACN,KAAD,CAAb;EACD;;EAED,IAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;IAC7B,MAAM,IAAIO,KAAJ,CAAU,+CAAV,CAAN;EACD;;EAED,MAAM,IAAIA,KAAJ,CAAU,wBAAV,CAAN;AACD,CAlBD;;AAoBA,IAAMC,yBAAyB,GAAG,SAA5BA,yBAA4B,CAAAC,MAAM;EAAA,OAAIC,MAAM,CAACC,IAAP,CAAYF,MAAZ,EAAoBG,MAApB,CAA2B,UAACC,GAAD,EAAMC,GAAN,EAAc;IACnF,IAAMC,KAAK,GAAGN,MAAM,CAACK,GAAD,CAApB;;IAEA,IAAIA,GAAG,KAAK,QAAR,IAAoBb,KAAK,CAACC,OAAN,CAAca,KAAd,CAAxB,EAA8C;MAC5CA,KAAK,CAACC,OAAN,CAAc,UAAAC,IAAI,EAAI;QACpBJ,GAAG,CAACK,IAAJ,CAAS;UACPJ,GAAG,EAAE,QADE;UAEPC,KAAK,EAAEE;QAFA,CAAT;MAID,CALD;IAMD,CAPD,MAOO,IAAIR,MAAM,CAACK,GAAD,CAAN,KAAgB,IAAhB,IAAwBL,MAAM,CAACK,GAAD,CAAN,KAAgBK,SAA5C,EAAuD;MAC5DN,GAAG,CAACK,IAAJ,CAAS;QACPJ,GAAG,EAAHA,GADO;QAEPC,KAAK,EAAEN,MAAM,CAACK,GAAD;MAFN,CAAT;IAID;;IAED,OAAOD,GAAP;EACD,CAlB2C,EAkBzC,EAlByC,CAAJ;AAAA,CAAxC;;AAoBA,IAAMO,4BAA4B,GAAG,SAA/BA,4BAA+B,CAAAX,MAAM,EAAI;EAC7C,IAAMY,cAAc,GAAGb,yBAAyB,CAACC,MAAD,CAAhD;EACA,OAAOY,cAAc,CAAClB,GAAf,CAAmB;IAAA,IACxBW,GADwB,QACxBA,GADwB;IAAA,IAExBC,KAFwB,QAExBA,KAFwB;IAAA,OAGpB,GAAGO,MAAH,CAAUjB,kBAAkB,CAACS,GAAD,CAA5B,EAAmC,GAAnC,EAAwCQ,MAAxC,CAA+CvB,oBAAoB,CAACgB,KAAD,CAAnE,CAHoB;EAAA,CAAnB,EAG4EX,IAH5E,CAGiF,GAHjF,CAAP;AAID,CAND;;AAQA,IAAMmB,YAAY,GAAG,UAArB;;AAEA,IAAMC,QAAQ,GAAG,SAAXA,QAAW,CAAAC,QAAQ;EAAA,OAAIA,QAAQ,CAACC,UAAT,CAAoBH,YAApB,CAAJ;AAAA,CAAzB;;AAEA,IAAMI,cAAc,GAAG,SAAjBA,cAAiB,CAAAF,QAAQ;EAAA,OAAI5B,QAAQ,CAAC,kBAAD,EAAqB,GAAGyB,MAAH,CAAUG,QAAQ,CAACG,MAAT,CAAgBL,YAAY,CAACM,MAA7B,CAAV,EAAgD,SAAhD,CAArB,CAAZ;AAAA,CAA/B;;AAEA,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAACL,QAAD,EAAWM,MAAX,EAAsB;EAC3C,IAAIN,QAAQ,KAAK,SAAb,IAA0BA,QAAQ,CAACC,UAAT,CAAoB,UAApB,CAA9B,EAA+D;IAC7D,IAAIM,qBAAJ,EAA2BC,sBAA3B;;IAEA,IAAI,EAAE,CAACD,qBAAqB,GAAGD,MAAM,CAACG,aAAhC,MAAmD,IAAnD,IAA2DF,qBAAqB,KAAK,KAAK,CAA1F,IAA+FA,qBAAqB,CAACG,KAAvH,KAAiI,CAAC,CAACF,sBAAsB,GAAGF,MAAM,CAACG,aAAjC,MAAoD,IAApD,IAA4DD,sBAAsB,KAAK,KAAK,CAA5F,GAAgG,KAAK,CAArG,GAAyGA,sBAAsB,CAACE,KAAjI,IAA0I,EAA/Q,EAAmR;MACjR,OAAO,IAAP;IACD;EACF;;EAED,OAAO,KAAP;AACD,CAVD;;AAYA,OAAO,IAAMC,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACC,IAAD,EAAOC,KAAP,EAAcC,IAAd,EAAuB;EACxD,IACEd,QADF,GAIIa,KAJJ,CACEb,QADF;EAAA,IAEEe,EAFF,GAIIF,KAJJ,CAEEE,EAFF;EAAA,oBAIIF,KAJJ,CAGE7B,MAHF;EAAA,IAGEA,MAHF,8BAGW,EAHX;EAKA,IAAMgC,OAAO,GAAGX,cAAc,CAACL,QAAD,EAAWY,IAAI,CAACN,MAAhB,CAAd,GAAwCM,IAAI,CAACK,kBAA7C,GAAkEL,IAAI,CAACM,gBAAvF;EACA,IAAMC,IAAI,GAAGpB,QAAQ,CAACC,QAAD,CAAR,GAAqBE,cAAc,CAACF,QAAD,CAAnC,GAAgD5B,QAAQ,CAAC4C,OAAD,EAAUhB,QAAV,EAAoBe,EAApB,CAArE;EACA1C,qBAAqB,CAACwC,KAAD,EAAQC,IAAR,CAArB;;EAEA,IAAI7B,MAAM,CAACC,IAAP,CAAYF,MAAZ,EAAoBoB,MAAxB,EAAgC;IAC9B,OAAO,GAAGP,MAAH,CAAUsB,IAAV,EAAgB,GAAhB,EAAqBtB,MAArB,CAA4BF,4BAA4B,CAACX,MAAD,CAAxD,CAAP;EACD;;EAED,OAAOmC,IAAP;AACD,CAfM"},"metadata":{},"sourceType":"module"}