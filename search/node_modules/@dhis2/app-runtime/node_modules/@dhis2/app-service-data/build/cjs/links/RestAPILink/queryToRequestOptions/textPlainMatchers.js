"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.isMetadataPackageInstallation = exports.addOrUpdateConfigurationProperty = exports.isAddOrUpdateSystemOrUserSetting = exports.isInterpretationCommentUpdate = exports.isCommentOnInterpretation = exports.isUpdateInterpretation = exports.isCreateInterpretation = exports.isCreateFeedbackMessage = exports.isReplyToMessageConversation = void 0;

/*
 * Requests that expect a "text/plain" Content-Type have been collected by scanning
 * the developer documentation:
 * https://docs.dhis2.org/master/en/developer/html/dhis2_developer_manual_full.html
 *
 * Note that currently it is not allowed to include an id property on a "create"
 * mutation object. This means that currently the `id` will always be included in
 * the resource property (string). If we decide to allow the `id` property for
 * "create" mutation-objects, we will have to include additional checks below.
 */
// POST to `messageConversations/${id}` (reply to a messagConversation)
const isReplyToMessageConversation = (type, {
  resource
}) => {
  const pattern = /^messageConversations\/[a-zA-Z0-9]{11}$/;
  return type === 'create' && pattern.test(resource);
}; // POST to 'messageConversations/feedback' (create a feedback message)


exports.isReplyToMessageConversation = isReplyToMessageConversation;

const isCreateFeedbackMessage = (type, {
  resource
}) => type === 'create' && resource === 'messageConversations/feedback'; // POST `interpretations/${objectType}/${id}` (add an interpretation to a visualization)


exports.isCreateFeedbackMessage = isCreateFeedbackMessage;

const isCreateInterpretation = (type, {
  resource
}) => {
  const pattern = /^interpretations\/(?:reportTable|chart|visualization|map|eventVisualization|eventReport|eventChart|dataSetReport)\/[a-zA-Z0-9]{11}$/;
  return type === 'create' && pattern.test(resource);
}; // PUT to `interpretations/${id}` (update an interpretation)


exports.isCreateInterpretation = isCreateInterpretation;

const isUpdateInterpretation = (type, {
  resource,
  id
}) => {
  if (type !== 'replace') {
    return false;
  }

  let resourcePattern;

  if (id) {
    resourcePattern = /^interpretations$/;
    const idPattern = /^[a-zA-Z0-9]{11}$/;
    return resourcePattern.test(resource) && idPattern.test(id);
  }

  resourcePattern = /^interpretations\/[a-zA-Z0-9]{11}$/;
  return resourcePattern.test(resource);
}; // POST to `interpretations/${id}/comments` (comment on an interpretation)


exports.isUpdateInterpretation = isUpdateInterpretation;

const isCommentOnInterpretation = (type, {
  resource
}) => {
  const pattern = /^interpretations\/[a-zA-Z0-9]{11}\/comments$/;
  return type === 'create' && pattern.test(resource);
}; // PUT to `interpretations/${interpretationId}/comments/${commentId}`
// (update an interpretation comment)


exports.isCommentOnInterpretation = isCommentOnInterpretation;

const isInterpretationCommentUpdate = (type, {
  resource,
  id
}) => {
  if (type !== 'replace') {
    return false;
  }

  if (id) {
    const idPatternLong = /^[a-zA-Z0-9]{11}\/comments\/[a-zA-Z0-9]{11}$/;
    const idPatternShort = /^[a-zA-Z0-9]{11}$/;
    const resourcePattern = /^interpretations\/[a-zA-Z0-9]{11}\/comments$/;
    return resource === 'interpretations' && idPatternLong.test(id) || resourcePattern.test(resource) && idPatternShort.test(id);
  }

  const pattern = /^interpretations\/[a-zA-Z0-9]{11}\/comments\/[a-zA-Z0-9]{11}$/;
  return pattern.test(resource);
}; // POST to `systemSettings/${settingKey}` or `userSettings/${settingKey}`
// (add or update a single system or user setting)


exports.isInterpretationCommentUpdate = isInterpretationCommentUpdate;

const isAddOrUpdateSystemOrUserSetting = (type, {
  resource
}) => {
  // At least 4 chars because the all start with 'key' (i.e. keyStyle)
  const pattern = /^(?:systemSettings|userSettings)\/[a-zA-Z]{4,}$/;
  return type === 'create' && pattern.test(resource);
}; // POST to `configuration/${configurationProperty}`
// (add or update a single configuration property)


exports.isAddOrUpdateSystemOrUserSetting = isAddOrUpdateSystemOrUserSetting;

const addOrUpdateConfigurationProperty = (type, {
  resource
}) => {
  // NOTE: The corsWhitelist property does expect "application/json"
  const pattern = /^(configuration)\/([a-zA-Z]{1,50})$/;
  const match = resource.match(pattern);
  return type === 'create' && !!match && match[2] !== 'corsWhitelist';
}; // POST to 'synchronization/metadataPull' (install a metadata package)


exports.addOrUpdateConfigurationProperty = addOrUpdateConfigurationProperty;

const isMetadataPackageInstallation = (type, {
  resource
}) => type === 'create' && resource === 'synchronization/metadataPull';

exports.isMetadataPackageInstallation = isMetadataPackageInstallation;