{"ast":null,"code":"import { normativeMetadataResources } from './metadataResources';\n\nvar validatePagination = function validatePagination(query, warn) {\n  var _query$params, _query$params2;\n\n  if (!normativeMetadataResources.includes(query.resource)) {\n    return true;\n  }\n\n  if (((_query$params = query.params) === null || _query$params === void 0 ? void 0 : _query$params.paging) === false || ((_query$params2 = query.params) === null || _query$params2 === void 0 ? void 0 : _query$params2.paging) === 'false') {\n    warn('Data queries with paging=false are deprecated and should not be used!', query);\n    return false;\n  } // TODO: validate sub-resource pagination (i.e. fields=users~paging(1,50)[name] )\n\n\n  return true;\n};\n\nvar validateDeclarativeFields = function validateDeclarativeFields(query, warn) {\n  var _query$params3;\n\n  if (!normativeMetadataResources.includes(query.resource)) {\n    return true;\n  }\n\n  if (!((_query$params3 = query.params) !== null && _query$params3 !== void 0 && _query$params3.fields)) {\n    warn('Data queries should always specify fields to return', query);\n    return false;\n  } else {\n    var _fields;\n\n    var fields = undefined;\n\n    if (typeof query.params.fields === 'string') {\n      fields = query.params.fields.split(',').map(function (field) {\n        return field.trim();\n      });\n    } else if (Array.isArray(query.params.fields)) {\n      fields = query.params.fields.map(function (field) {\n        return String(field).trim();\n      });\n    }\n\n    if ((_fields = fields) !== null && _fields !== void 0 && _fields.find(function (field) {\n      return field.match(/(^\\*$|^:.+)/);\n    })) {\n      warn('Data queries should not use wildcard or dynamic field groups', query.params.fields, query);\n      return false;\n    }\n  } // TODO: validate sub-resource wildcard fields (i.e. fields=users[*])\n\n\n  return true;\n};\n\nexport var validateResourceQuery = function validateResourceQuery(query, type) {\n  var valid = true;\n\n  if (process.env.NODE_ENV === 'development') {\n    // Support build-time dead code elimination in production\n    var warn = console.warn;\n\n    if (type === 'read') {\n      valid = validatePagination(query, warn) && valid;\n      valid = validateDeclarativeFields(query, warn) && valid;\n    }\n  }\n\n  return valid;\n};","map":{"version":3,"names":["normativeMetadataResources","validatePagination","query","warn","_query$params","_query$params2","includes","resource","params","paging","validateDeclarativeFields","_query$params3","fields","_fields","undefined","split","map","field","trim","Array","isArray","String","find","match","validateResourceQuery","type","valid","process","env","NODE_ENV","console"],"sources":["/home/jake/SRC/landing-page/node_modules/@dhis2/app-runtime/node_modules/@dhis2/app-service-data/build/es/links/RestAPILink/validateQuery.js"],"sourcesContent":["import { normativeMetadataResources } from './metadataResources';\n\nconst validatePagination = (query, warn) => {\n  var _query$params, _query$params2;\n\n  if (!normativeMetadataResources.includes(query.resource)) {\n    return true;\n  }\n\n  if (((_query$params = query.params) === null || _query$params === void 0 ? void 0 : _query$params.paging) === false || ((_query$params2 = query.params) === null || _query$params2 === void 0 ? void 0 : _query$params2.paging) === 'false') {\n    warn('Data queries with paging=false are deprecated and should not be used!', query);\n    return false;\n  } // TODO: validate sub-resource pagination (i.e. fields=users~paging(1,50)[name] )\n\n\n  return true;\n};\n\nconst validateDeclarativeFields = (query, warn) => {\n  var _query$params3;\n\n  if (!normativeMetadataResources.includes(query.resource)) {\n    return true;\n  }\n\n  if (!((_query$params3 = query.params) !== null && _query$params3 !== void 0 && _query$params3.fields)) {\n    warn('Data queries should always specify fields to return', query);\n    return false;\n  } else {\n    var _fields;\n\n    let fields = undefined;\n\n    if (typeof query.params.fields === 'string') {\n      fields = query.params.fields.split(',').map(field => field.trim());\n    } else if (Array.isArray(query.params.fields)) {\n      fields = query.params.fields.map(field => String(field).trim());\n    }\n\n    if ((_fields = fields) !== null && _fields !== void 0 && _fields.find(field => field.match(/(^\\*$|^:.+)/))) {\n      warn('Data queries should not use wildcard or dynamic field groups', query.params.fields, query);\n      return false;\n    }\n  } // TODO: validate sub-resource wildcard fields (i.e. fields=users[*])\n\n\n  return true;\n};\n\nexport const validateResourceQuery = (query, type) => {\n  let valid = true;\n\n  if (process.env.NODE_ENV === 'development') {\n    // Support build-time dead code elimination in production\n    const warn = console.warn;\n\n    if (type === 'read') {\n      valid = validatePagination(query, warn) && valid;\n      valid = validateDeclarativeFields(query, warn) && valid;\n    }\n  }\n\n  return valid;\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}