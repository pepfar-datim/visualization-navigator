{"ast":null,"code":"import _slicedToArray from \"/home/jake/SRC/visualization-navigator-ts/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _createForOfIteratorHelper from \"/home/jake/SRC/visualization-navigator-ts/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport isEqual from 'lodash/isEqual';\nimport PropTypes from 'prop-types';\nimport React, { useEffect, useCallback, useContext, useState } from 'react'; // This file creates a redux-like state management service using React context\n// that minimizes unnecessary rerenders that consume the context.\n// See more at https://github.com/amcgee/state-service-poc\n\nvar identity = function identity(state) {\n  return state;\n};\n\nexport var createStore = function createStore() {\n  var initialState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var subscriptions = new Set();\n  var state = initialState;\n  return {\n    getState: function getState() {\n      return state;\n    },\n    subscribe: function subscribe(callback) {\n      subscriptions.add(callback);\n    },\n    unsubscribe: function unsubscribe(callback) {\n      subscriptions.delete(callback);\n    },\n    mutate: function mutate(mutation) {\n      state = mutation(state);\n\n      var _iterator = _createForOfIteratorHelper(subscriptions),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var callback = _step.value;\n          callback(state);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n  };\n};\nvar GlobalStateContext = /*#__PURE__*/React.createContext(createStore());\n\nvar useGlobalStateStore = function useGlobalStateStore() {\n  return useContext(GlobalStateContext);\n};\n\nexport var GlobalStateProvider = function GlobalStateProvider(_ref) {\n  var store = _ref.store,\n      children = _ref.children;\n  return /*#__PURE__*/React.createElement(GlobalStateContext.Provider, {\n    value: store\n  }, children);\n};\nGlobalStateProvider.propTypes = {\n  children: PropTypes.node,\n  store: PropTypes.shape({})\n};\nexport var useGlobalState = function useGlobalState() {\n  var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : identity;\n  var store = useGlobalStateStore();\n\n  var _useState = useState(selector(store.getState())),\n      _useState2 = _slicedToArray(_useState, 2),\n      selectedState = _useState2[0],\n      setSelectedState = _useState2[1];\n\n  useEffect(function () {\n    // NEW: deep equality check before updating\n    var callback = function callback(state) {\n      var newSelectedState = selector(state); // Second condition handles case where a selected object gets\n      // deleted, but state does not update\n\n      if (!isEqual(selectedState, newSelectedState) || selectedState === undefined) setSelectedState(newSelectedState);\n    };\n\n    store.subscribe(callback); // Make sure to update state when selector changes\n\n    callback(store.getState());\n    return function () {\n      return store.unsubscribe(callback);\n    };\n  }, [store, selector]);\n  /* eslint-disable-line react-hooks/exhaustive-deps */\n\n  return [selectedState, store.mutate];\n};\nexport function useGlobalStateMutation(mutationCreator) {\n  var store = useGlobalStateStore();\n  return useCallback(function () {\n    store.mutate(mutationCreator.apply(void 0, arguments));\n  }, [mutationCreator, store]);\n}","map":{"version":3,"names":["isEqual","PropTypes","React","useEffect","useCallback","useContext","useState","identity","state","createStore","initialState","subscriptions","Set","getState","subscribe","callback","add","unsubscribe","delete","mutate","mutation","GlobalStateContext","createContext","useGlobalStateStore","GlobalStateProvider","store","children","createElement","Provider","value","propTypes","node","shape","useGlobalState","selector","selectedState","setSelectedState","newSelectedState","undefined","useGlobalStateMutation","mutationCreator"],"sources":["/home/jake/SRC/visualization-navigator-ts/node_modules/@dhis2/app-runtime/node_modules/@dhis2/app-service-offline/build/es/lib/global-state-service.js"],"sourcesContent":["import isEqual from 'lodash/isEqual';\nimport PropTypes from 'prop-types';\nimport React, { useEffect, useCallback, useContext, useState } from 'react';\n\n// This file creates a redux-like state management service using React context\n// that minimizes unnecessary rerenders that consume the context.\n// See more at https://github.com/amcgee/state-service-poc\nconst identity = state => state;\n\nexport const createStore = (initialState = {}) => {\n  const subscriptions = new Set();\n  let state = initialState;\n  return {\n    getState: () => state,\n    subscribe: callback => {\n      subscriptions.add(callback);\n    },\n    unsubscribe: callback => {\n      subscriptions.delete(callback);\n    },\n    mutate: mutation => {\n      state = mutation(state);\n\n      for (const callback of subscriptions) {\n        callback(state);\n      }\n    }\n  };\n};\nconst GlobalStateContext = /*#__PURE__*/React.createContext(createStore());\n\nconst useGlobalStateStore = () => useContext(GlobalStateContext);\n\nexport const GlobalStateProvider = ({\n  store,\n  children\n}) => /*#__PURE__*/React.createElement(GlobalStateContext.Provider, {\n  value: store\n}, children);\nGlobalStateProvider.propTypes = {\n  children: PropTypes.node,\n  store: PropTypes.shape({})\n};\nexport const useGlobalState = (selector = identity) => {\n  const store = useGlobalStateStore();\n  const [selectedState, setSelectedState] = useState(selector(store.getState()));\n  useEffect(() => {\n    // NEW: deep equality check before updating\n    const callback = state => {\n      const newSelectedState = selector(state); // Second condition handles case where a selected object gets\n      // deleted, but state does not update\n\n      if (!isEqual(selectedState, newSelectedState) || selectedState === undefined) setSelectedState(newSelectedState);\n    };\n\n    store.subscribe(callback); // Make sure to update state when selector changes\n\n    callback(store.getState());\n    return () => store.unsubscribe(callback);\n  }, [store, selector]);\n  /* eslint-disable-line react-hooks/exhaustive-deps */\n\n  return [selectedState, store.mutate];\n};\nexport function useGlobalStateMutation(mutationCreator) {\n  const store = useGlobalStateStore();\n  return useCallback((...args) => {\n    store.mutate(mutationCreator(...args));\n  }, [mutationCreator, store]);\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}