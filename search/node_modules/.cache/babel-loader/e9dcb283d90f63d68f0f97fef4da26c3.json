{"ast":null,"code":"function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nimport { getMutationFetchType } from './helpers/getMutationFetchType';\nimport { resolveDynamicQuery } from './helpers/resolveDynamicQuery';\nimport { validateResourceQuery, validateResourceQueries } from './helpers/validate';\n\nconst reduceResponses = (responses, names) => responses.reduce((out, response, idx) => {\n  out[names[idx]] = response;\n  return out;\n}, {});\n\nexport class DataEngine {\n  constructor(link) {\n    _defineProperty(this, \"link\", void 0);\n\n    this.link = link;\n  }\n\n  query(query) {\n    let {\n      variables = {},\n      signal,\n      onComplete,\n      onError\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const names = Object.keys(query);\n    const queries = names.map(name => query[name]).map(q => resolveDynamicQuery(q, variables));\n    validateResourceQueries(queries, names);\n    return Promise.all(queries.map(q => {\n      return this.link.executeResourceQuery('read', q, {\n        signal\n      });\n    })).then(results => {\n      const data = reduceResponses(results, names);\n      onComplete && onComplete(data);\n      return data;\n    }).catch(error => {\n      onError && onError(error);\n      throw error;\n    });\n  }\n\n  mutate(mutation) {\n    let {\n      variables = {},\n      signal,\n      onComplete,\n      onError\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const query = resolveDynamicQuery(mutation, variables);\n    const type = getMutationFetchType(mutation);\n    validateResourceQuery(type, query);\n    const result = this.link.executeResourceQuery(type, query, {\n      signal\n    });\n    return result.then(data => {\n      onComplete && onComplete(data);\n      return data;\n    }).catch(error => {\n      onError && onError(error);\n      throw error;\n    });\n  }\n\n}\nexport default DataEngine;","map":{"version":3,"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","getMutationFetchType","resolveDynamicQuery","validateResourceQuery","validateResourceQueries","reduceResponses","responses","names","reduce","out","response","idx","DataEngine","constructor","link","query","variables","signal","onComplete","onError","keys","queries","map","name","q","Promise","all","executeResourceQuery","then","results","data","catch","error","mutate","mutation","type","result"],"sources":["/home/jake/SRC/visualization-navigator-ts/node_modules/@dhis2/app-runtime/node_modules/@dhis2/app-service-data/build/es/engine/DataEngine.js"],"sourcesContent":["function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { getMutationFetchType } from './helpers/getMutationFetchType';\nimport { resolveDynamicQuery } from './helpers/resolveDynamicQuery';\nimport { validateResourceQuery, validateResourceQueries } from './helpers/validate';\n\nconst reduceResponses = (responses, names) => responses.reduce((out, response, idx) => {\n  out[names[idx]] = response;\n  return out;\n}, {});\n\nexport class DataEngine {\n  constructor(link) {\n    _defineProperty(this, \"link\", void 0);\n\n    this.link = link;\n  }\n\n  query(query, {\n    variables = {},\n    signal,\n    onComplete,\n    onError\n  } = {}) {\n    const names = Object.keys(query);\n    const queries = names.map(name => query[name]).map(q => resolveDynamicQuery(q, variables));\n    validateResourceQueries(queries, names);\n    return Promise.all(queries.map(q => {\n      return this.link.executeResourceQuery('read', q, {\n        signal\n      });\n    })).then(results => {\n      const data = reduceResponses(results, names);\n      onComplete && onComplete(data);\n      return data;\n    }).catch(error => {\n      onError && onError(error);\n      throw error;\n    });\n  }\n\n  mutate(mutation, {\n    variables = {},\n    signal,\n    onComplete,\n    onError\n  } = {}) {\n    const query = resolveDynamicQuery(mutation, variables);\n    const type = getMutationFetchType(mutation);\n    validateResourceQuery(type, query);\n    const result = this.link.executeResourceQuery(type, query, {\n      signal\n    });\n    return result.then(data => {\n      onComplete && onComplete(data);\n      return data;\n    }).catch(error => {\n      onError && onError(error);\n      throw error;\n    });\n  }\n\n}\nexport default DataEngine;"],"mappings":"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"},"metadata":{},"sourceType":"module"}