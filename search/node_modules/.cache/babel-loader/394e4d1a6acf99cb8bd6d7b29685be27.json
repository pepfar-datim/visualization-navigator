{"ast":null,"code":"import _classCallCheck from \"/home/jake/SRC/visualization-navigator-ts/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/jake/SRC/visualization-navigator-ts/node_modules/@babel/runtime/helpers/esm/createClass.js\";\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nimport { getMutationFetchType } from './helpers/getMutationFetchType';\nimport { resolveDynamicQuery } from './helpers/resolveDynamicQuery';\nimport { validateResourceQuery, validateResourceQueries } from './helpers/validate';\n\nvar reduceResponses = function reduceResponses(responses, names) {\n  return responses.reduce(function (out, response, idx) {\n    out[names[idx]] = response;\n    return out;\n  }, {});\n};\n\nexport var DataEngine = /*#__PURE__*/function () {\n  function DataEngine(link) {\n    _classCallCheck(this, DataEngine);\n\n    _defineProperty(this, \"link\", void 0);\n\n    this.link = link;\n  }\n\n  _createClass(DataEngine, [{\n    key: \"query\",\n    value: function query(_query) {\n      var _this = this;\n\n      var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          _ref$variables = _ref.variables,\n          variables = _ref$variables === void 0 ? {} : _ref$variables,\n          signal = _ref.signal,\n          onComplete = _ref.onComplete,\n          onError = _ref.onError;\n\n      var names = Object.keys(_query);\n      var queries = names.map(function (name) {\n        return _query[name];\n      }).map(function (q) {\n        return resolveDynamicQuery(q, variables);\n      });\n      validateResourceQueries(queries, names);\n      return Promise.all(queries.map(function (q) {\n        return _this.link.executeResourceQuery('read', q, {\n          signal: signal\n        });\n      })).then(function (results) {\n        var data = reduceResponses(results, names);\n        onComplete && onComplete(data);\n        return data;\n      }).catch(function (error) {\n        onError && onError(error);\n        throw error;\n      });\n    }\n  }, {\n    key: \"mutate\",\n    value: function mutate(mutation) {\n      var _ref2 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          _ref2$variables = _ref2.variables,\n          variables = _ref2$variables === void 0 ? {} : _ref2$variables,\n          signal = _ref2.signal,\n          onComplete = _ref2.onComplete,\n          onError = _ref2.onError;\n\n      var query = resolveDynamicQuery(mutation, variables);\n      var type = getMutationFetchType(mutation);\n      validateResourceQuery(type, query);\n      var result = this.link.executeResourceQuery(type, query, {\n        signal: signal\n      });\n      return result.then(function (data) {\n        onComplete && onComplete(data);\n        return data;\n      }).catch(function (error) {\n        onError && onError(error);\n        throw error;\n      });\n    }\n  }]);\n\n  return DataEngine;\n}();\nexport default DataEngine;","map":{"version":3,"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","getMutationFetchType","resolveDynamicQuery","validateResourceQuery","validateResourceQueries","reduceResponses","responses","names","reduce","out","response","idx","DataEngine","link","query","variables","signal","onComplete","onError","keys","queries","map","name","q","Promise","all","executeResourceQuery","then","results","data","catch","error","mutation","type","result"],"sources":["/home/jake/SRC/visualization-navigator-ts/node_modules/@dhis2/app-runtime/node_modules/@dhis2/app-service-data/build/es/engine/DataEngine.js"],"sourcesContent":["function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { getMutationFetchType } from './helpers/getMutationFetchType';\nimport { resolveDynamicQuery } from './helpers/resolveDynamicQuery';\nimport { validateResourceQuery, validateResourceQueries } from './helpers/validate';\n\nconst reduceResponses = (responses, names) => responses.reduce((out, response, idx) => {\n  out[names[idx]] = response;\n  return out;\n}, {});\n\nexport class DataEngine {\n  constructor(link) {\n    _defineProperty(this, \"link\", void 0);\n\n    this.link = link;\n  }\n\n  query(query, {\n    variables = {},\n    signal,\n    onComplete,\n    onError\n  } = {}) {\n    const names = Object.keys(query);\n    const queries = names.map(name => query[name]).map(q => resolveDynamicQuery(q, variables));\n    validateResourceQueries(queries, names);\n    return Promise.all(queries.map(q => {\n      return this.link.executeResourceQuery('read', q, {\n        signal\n      });\n    })).then(results => {\n      const data = reduceResponses(results, names);\n      onComplete && onComplete(data);\n      return data;\n    }).catch(error => {\n      onError && onError(error);\n      throw error;\n    });\n  }\n\n  mutate(mutation, {\n    variables = {},\n    signal,\n    onComplete,\n    onError\n  } = {}) {\n    const query = resolveDynamicQuery(mutation, variables);\n    const type = getMutationFetchType(mutation);\n    validateResourceQuery(type, query);\n    const result = this.link.executeResourceQuery(type, query, {\n      signal\n    });\n    return result.then(data => {\n      onComplete && onComplete(data);\n      return data;\n    }).catch(error => {\n      onError && onError(error);\n      throw error;\n    });\n  }\n\n}\nexport default DataEngine;"],"mappings":"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"},"metadata":{},"sourceType":"module"}